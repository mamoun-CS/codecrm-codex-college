# ============================================
# PERFORMANCE-OPTIMIZED ENVIRONMENT CONFIGURATION
# ============================================
# Copy this file to .env and adjust values for your environment

# ============================================
# DATABASE CONFIGURATION
# ============================================
DB_HOST=localhost
DB_PORT=5432
DB_USERNAME=postgres
DB_PASSWORD=your_secure_password
DB_NAME=crm_db

# Connection Pool Settings (Optimized for 10,000+ concurrent users)
DB_POOL_MAX=100
DB_POOL_MIN=10
DB_IDLE_TIMEOUT=30000
DB_CONNECTION_TIMEOUT=5000
DB_STATEMENT_TIMEOUT=10000

# ============================================
# REDIS CONFIGURATION (REQUIRED FOR PERFORMANCE)
# ============================================
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=your_redis_password
REDIS_ENABLED=true

# Redis Cache Settings
REDIS_TTL=60000  # 60 seconds default TTL
REDIS_MAX_MEMORY=2gb
REDIS_EVICTION_POLICY=allkeys-lru

# ============================================
# APPLICATION SETTINGS
# ============================================
NODE_ENV=production
PORT=3000

# Enable clustering for multi-core utilization
CLUSTER_MODE=true
CLUSTER_WORKERS=auto  # auto = number of CPU cores

# ============================================
# PERFORMANCE MONITORING
# ============================================
ENABLE_PERFORMANCE_MONITORING=true
SLOW_QUERY_THRESHOLD=100  # Log queries slower than 100ms
VERY_SLOW_QUERY_THRESHOLD=500  # Error log for queries slower than 500ms

# ============================================
# CACHING STRATEGY
# ============================================
# Cache TTL by data type (in seconds)
CACHE_TTL_LEAD=60
CACHE_TTL_USER=300
CACHE_TTL_CAMPAIGN=120
CACHE_TTL_ANALYTICS=60
CACHE_TTL_STATS=30

# Enable TypeORM query cache
TYPEORM_CACHE_ENABLED=true
TYPEORM_CACHE_DURATION=10000  # 10 seconds

# ============================================
# RATE LIMITING & THROTTLING
# ============================================
THROTTLE_TTL=60
THROTTLE_LIMIT=100  # 100 requests per minute per IP

# ============================================
# SECURITY
# ============================================
JWT_SECRET=your_jwt_secret_key_change_this
JWT_EXPIRATION=24h

# CORS Settings
CORS_ORIGIN=http://localhost:3001,https://yourdomain.com
CORS_CREDENTIALS=true

# ============================================
# LOGGING
# ============================================
LOG_LEVEL=info  # debug, info, warn, error
LOG_SQL_QUERIES=false  # Set to true only in development
LOG_SLOW_QUERIES=true

# ============================================
# INTEGRATIONS (Optional)
# ============================================
# Meta (Facebook/Instagram)
META_APP_ID=your_meta_app_id
META_APP_SECRET=your_meta_app_secret
META_VERIFY_TOKEN=your_verify_token

# TikTok
TIKTOK_APP_ID=your_tiktok_app_id
TIKTOK_APP_SECRET=your_tiktok_app_secret

# Google Ads
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret

# WhatsApp
WHATSAPP_API_URL=https://graph.facebook.com/v18.0
WHATSAPP_ACCESS_TOKEN=your_whatsapp_token

# ============================================
# OPTIMIZATION FLAGS
# ============================================
# Enable bulk operations
ENABLE_BULK_OPERATIONS=true
BULK_INSERT_CHUNK_SIZE=100

# Enable cursor pagination
ENABLE_CURSOR_PAGINATION=true
DEFAULT_PAGE_SIZE=25
MAX_PAGE_SIZE=100

# Enable query result caching
ENABLE_QUERY_CACHE=true

# Enable compression
ENABLE_COMPRESSION=true
COMPRESSION_THRESHOLD=1024  # Compress responses > 1KB

# ============================================
# MEMORY MANAGEMENT
# ============================================
# Node.js memory limits
NODE_OPTIONS=--max-old-space-size=2048  # 2GB heap size

# Garbage collection tuning
GC_INTERVAL=60000  # Force GC every 60 seconds if needed

# ============================================
# HEALTH CHECK
# ============================================
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_PATH=/health
HEALTH_CHECK_INTERVAL=30000  # 30 seconds

# ============================================
# METRICS & MONITORING
# ============================================
METRICS_ENABLED=true
METRICS_PATH=/metrics
METRICS_RETENTION=1000  # Keep last 1000 metrics per type

# ============================================
# PRODUCTION OPTIMIZATIONS
# ============================================
# Disable unnecessary features in production
SWAGGER_ENABLED=false  # Disable Swagger in production
GRAPHQL_PLAYGROUND=false  # Disable GraphQL playground in production
GRAPHQL_INTROSPECTION=false  # Disable introspection in production

# ============================================
# LOAD BALANCER SETTINGS
# ============================================
TRUST_PROXY=true  # Enable if behind a load balancer
PROXY_TIMEOUT=30000  # 30 seconds

# ============================================
# BACKUP & RECOVERY
# ============================================
BACKUP_ENABLED=true
BACKUP_INTERVAL=86400000  # Daily backups (24 hours)
BACKUP_RETENTION=7  # Keep 7 days of backups

